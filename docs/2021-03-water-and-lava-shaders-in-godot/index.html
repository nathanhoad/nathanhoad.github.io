<!DOCTYPE html> <html lang="en-AU"> <head> <meta charset="utf-8"> <title>2D water and lava shaders in Godot - Nathan Hoad</title> <meta property="og:title" content="2D water and lava shaders in Godot - Nathan Hoad"> <meta name="description" content="Water shaders are definitely something you can spend a lot of time on. Mine, however, is not one of those."> <meta
property="og:description" content="Water shaders are definitely something you can spend a lot of time on. Mine, however, is not one of those."> <meta property="og:image" content="https://nathanhoad.net/share.jpg"> <meta property="og:url" content="https://nathanhoad.net/2021-03-water-and-lava-shaders-in-godot"> <meta name="author" content="Nathan Hoad"> <meta
name="verify-v1" content="FJjra037EqYRGo8w0Atq5BHkBi8B+MPZSD+0jKQebLs="> <meta name="p:domain_verify" content="5c8fe00840c14d6c92865fc017137b69"> <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,viewport-fit=cover"> <link
type="image/png" href="/favicon.png" rel="icon"> <link href="https://fonts.googleapis.com/css?family=Enriqueta|Open+Sans:400,700&display=swap" rel="stylesheet"> <meta http-equiv="Content-Security-Policy" content="script-src 'self'"> <script defer="defer"
src="/enhance.js"></script> <style type="text/css">
@charset "UTF-8";*{box-sizing:border-box}body,html{margin:0;padding:0;font-family:Enriqueta,Georgia,"Times New Roman",Times,serif}hr{border:none;border-bottom:1px solid #ccc;height:1px;margin:60px auto;max-width:60%}body>aside:first-child{padding:20px 40px;margin-bottom:120px;position:relative;display:flex}body>aside:first-child span{flex-grow:1;flex-shrink:0}body>aside:first-child>a{display:inline-block;vertical-align:middle;padding-top:32px;color:#666;font-family:"Open Sans",Arial,Helvetica,sans-serif;margin-right:20px;text-transform:uppercase;font-size:14px;text-decoration:none;font-weight:700;flex-grow:0;position:relative}body>aside:first-child>a:hover{color:#000}body>aside:first-child>a:first-of-type{background:url(/logo.png) no-repeat top left;background-size:64px 64px;padding-top:32px;height:64px;padding-left:80px;color:#292929;font-weight:700;font-size:18px}body>aside:first-child>a:last-of-type{margin-right:0}body>aside:first-child>a[href*=youtube]:hover{border-bottom:2px solid red}body>aside:first-child>a[href*=twitter]:hover{border-bottom:2px solid #1da1f2}@media screen and (max-width:440px){body>aside:first-child{padding:10px;margin-bottom:100px}body>aside:first-child>a{display:none}body>aside:first-child>a:first-of-type{display:inline-block}}.welcome{margin:0 auto 60px auto;position:relative;overflow:hidden;width:100%;height:100vh;clip:rect(0,auto,auto,0);clip-path:polygon(0 0,0 100%,100% 100%,100% 0)}.welcome:before{content:"";display:block;width:100%;height:100%;background-color:#110c2c;background-image:linear-gradient(180deg,#110c2c 0,#8e0075 17%,#ff0049 41%,#fc0 60%);position:fixed;top:0;z-index:-1}.welcome>div:first-child{background-image:url(home.png);background-size:cover;background-position:center;position:fixed;width:100%;height:100vh}.welcome>div:first-child>div:first-child{position:absolute;top:0;left:0;width:100%;height:100vh;background-image:url(home.gif);background-size:cover;background-position:center}.welcome>div:first-child>h1{text-indent:-10000px;color:transparent;position:absolute;top:12vh;left:50%;max-width:700px;width:90%;height:50vh;transform:translate(-50%,0);background-image:url(home.svg);background-repeat:no-repeat;background-size:contain}.about{margin-bottom:80px}.about>p{font-size:26px;line-height:38px;color:#222;margin:0 auto 20px auto;padding:0;max-width:700px}@media screen and (max-width:440px){.about>p{font-size:22px;line-height:30px;max-width:100%;padding:0 20px}}.about a{color:#000}.contents ul{list-style:none;padding:0;max-width:700px;margin:auto}@media screen and (max-width:440px){.contents ul{width:100%;padding:0 20px}}.contents li{margin-bottom:30px}.contents a{color:#000;font-family:"Open Sans",Arial,Helvetica,sans-serif;text-decoration:none}.contents a:hover{text-decoration:underline}.contents h2{font-size:26px;line-height:38px;margin-bottom:10px}.contents .meta{font-size:16px;margin:0 auto;color:#999;font-family:Arial,Helvetica,sans-serif}.not-found{max-width:900px;margin:auto;padding:40px;padding-bottom:20px;margin-bottom:100px;border-radius:5px;min-height:40vh}.not-found a{color:#000}.not-found h1,.not-found p{max-width:700px;margin:auto;font-family:"Open Sans",Arial,Helvetica,sans-serif}.not-found h1{font-size:40px;line-height:50px;margin-bottom:20px}.not-found p{font-size:22px;line-height:32px;margin-bottom:20px}body>article>header{max-width:960px;margin:50px auto;position:relative;text-align:center;padding-bottom:50px}@media screen and (max-width:440px){body>article>header{max-width:calc(100%)}}@media screen and (max-width:1200px){body>article>header{max-width:calc(100%);padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right)}}body>article>header:after{content:"";position:absolute;left:50%;bottom:0;width:150px;height:1px;background:#ccc;transform:translateX(-50%)}body>article>section{max-width:700px;margin:auto;font-size:20px;line-height:32px}@media screen and (max-width:440px){body>article>section{max-width:100%;padding:0 10px}}body>article h1{font-size:50px;line-height:55px;margin-bottom:30px;font-family:"Open Sans",Arial,Helvetica,sans-serif;font-weight:700}@media screen and (max-width:440px){body>article h1{font-size:40px;line-height:48px;padding:5px}}body>article .meta{font-size:18px;margin:0 auto;color:#999;font-family:Arial,Helvetica,sans-serif}body>article h2{font-size:26px;line-height:32px;margin-top:60px;font-family:"Open Sans",Georgia,"Times New Roman",Times,serif;font-weight:700}@media screen and (max-width:440px){body>article h2{font-size:22px;line-height:30px}}body>article a{color:#000;text-decoration:underline}body>article img,body>article video{max-width:100%}body>article figure{margin:0;margin-bottom:20px}body>article figure img{max-width:100%}body>article figcaption{padding:0 3px;color:#333;font-size:12px;line-height:16px;font-family:"Open Sans",Georgia,"Times New Roman",Times,serif}body>article pre{margin:40px -130px;padding:8px 16px;background:#ddd;color:#000;border-radius:3px;font-size:14px;overflow-x:scroll;font-family:monospace}@media screen and (max-width:440px){body>article pre{max-width:calc(100% + 20px);margin:0 -10px;border-radius:0}}body>article pre[class*=language-]{font-size:15px;background:#292d3e;color:#c8cde8;line-height:22px;font-weight:700}body>article pre[class*=language-] .class-name,body>article pre[class*=language-] .namespace{color:#ffcb6b}body>article pre[class*=language-] .class-name .keyword,body>article pre[class*=language-] .namespace .keyword{color:#f78c6c}body>article pre[class*=language-] .comment{color:#676e95}body>article pre[class*=language-] .variable{color:#c3e883}body>article pre[class*=language-] .keyword{color:#c792ea}body>article pre[class*=language-] .keyword.control{color:#89ddff}body>article pre[class*=language-] .function{color:#82aaff}body>article pre[class*=language-] .string{color:#c3e883}body>article pre[class*=language-] .boolean{color:#f78c6c}body>article pre[class*=language-] .number{color:#f78c6c}body>article pre[class*=language-] .constant{color:#fff}body>article pre[class*=language-] .operator,body>article pre[class*=language-] .punctuation{color:#a6accd}body>article a>code,body>article li>code,body>article p>code{background:#ddd;font-size:16px;padding:4px 8px;color:#000;border-radius:3px;font-family:"Courier New",Courier,monospace;font-weight:700}body>article blockquote{font-style:italic;margin:30px 0;font-size:22px;line-height:28px;color:#333;padding:0 40px;color:#000}body>article blockquote .author{padding-top:0;padding-left:60px;line-height:26px;font-size:18px;margin-top:-10px;color:#666}body>article hr{border:none;margin-bottom:80px}body>article hr:after{content:"∗ ∗ ∗";display:block;text-align:center;color:#ccc;font-size:30px}body>article ol li,body>article ul li{margin-bottom:20px}body>article footer{margin-top:60px}body>article footer a{color:#db3e00}body>article .tweet{border:1px solid #ccc;border-radius:5px;padding:20px;font-family:Arial,Helvetica,sans-serif;font-size:14px;line-height:22px;color:#000;font-style:normal}body>article .tweet a{text-decoration:none}body>article .tweet .tweet-profile{display:block;position:relative;padding-left:42px;color:#000;font-size:12px;line-height:16px;color:#666;margin-bottom:10px}body>article .tweet .tweet-profile strong{color:#000;display:block;font-size:14px;line-height:16px;position:relative}body>article .tweet .tweet-profile strong em{display:inline-block;font-size:9px;color:#fff;background:#3794db;border-radius:50%;width:14px;height:14px;line-height:14px;font-style:normal;text-align:center;vertical-align:middle;text-indent:-1px;transform:translateY(-1px);margin-left:3px}body>article .tweet .tweet-profile>img{position:absolute;top:0;left:0;width:32px;height:32px;border-radius:50%}body>article .tweet .tweet-profile:hover>strong{text-decoration:underline}body>article .tweet .tweet-time{margin:20px -20px -20px -20px;padding:10px 20px;border-top:1px solid #ddd;font-size:14px;color:#888;display:block;text-decoration:none}body>article .tweet p{margin:0 0 10px 0}body>article .tweet p>a{color:#2b7bb9;text-decoration:underline;margin-right:3px}body>article .tweet p>a[href*=hashtag]{color:#888}body>article .tweet p>img{border-radius:3px}@media screen and (max-width:440px){body>article .tweet{max-width:100%}}body>article .gist{margin:40px -130px}@media screen and (max-width:440px){body>article .gist{max-width:100%;margin:0}}body>article iframe[src^="https://www.youtube"]{width:960px;height:540px;margin:0 -130px}@media screen and (max-width:440px){body>article iframe[src^="https://www.youtube"]{width:calc(100% + 20px);height:240px;max-width:calc(100% + 20px);margin:0 -20px}}.tag>header{text-align:center;font-family:"Open Sans",Georgia,"Times New Roman",Times,serif;margin-bottom:60px;color:#999}body>footer{border-top:2px solid #ccc;background:#f9f9f9;padding-top:0;margin:120px 0 0 0;padding-bottom:80px;padding:40px 0}body>footer>ul{list-style:none;padding:0;font-family:Arial,Helvetica,sans-serif;text-align:center;margin:90px 0 10px 0;padding-top:150px;background:url(/footer.png) no-repeat top center;color:#666}body>footer>ul>li{display:inline-block;margin:0 5px}body>footer>ul>li>a{color:#666;text-decoration:none;font-weight:700}body>footer>ul>li>a:hover{text-decoration:underline}body>footer>aside{font-family:Arial,Helvetica,sans-serif;text-align:center;color:#666}body>footer>div{max-width:700px;width:100%;margin:auto;text-align:center}@media screen and (max-width:440px){body>footer>div{padding:0 20px}}body>footer>div p{margin:0;margin-bottom:30px;padding:0;font-size:22px;line-height:36px}body>footer>div a{color:#000;white-space:nowrap}body{width:100%}figure{position:relative}figure img+.play{position:absolute;top:48%;left:50%;transform:translate(-50%,-50%);width:60px;height:45px;background:url(/youtube-play.svg) no-repeat top left;pointer-events:none}.measure-scrollbar-width{width:100px;height:100px;overflow:scroll;position:absolute;top:-200%}.section-wide{margin:40px -130px}.section-wide video,.section-wide>*>img{width:100%}@media screen and (max-width:440px){.section-wide{float:none;margin:0 -10px}.section-wide figcaption{padding-left:calc(env(safe-area-inset-left) + 10px);padding-right:calc(env(safe-area-inset-right) + 10px)}}@media screen and (min-width:441px) and (max-width:1200px){.section-wide figcaption{padding-left:130px;padding-right:130px}}.section-full{margin-left:calc(-50vw + 50%);width:100vw;max-width:100vw}.section-full h1,.section-full p{padding-left:10px;padding-right:10px}.section-full>p>img{width:100%}@media screen and (max-width:440px){.section-full{margin:0}}.section-gallery p{margin:0;padding:0;line-height:0}.section-gallery .row{display:flex;justify-content:space-between;margin-bottom:4px}.section-gallery .row img{width:100vw}.section-gallery .row.one>*{max-width:100%}.section-gallery .row.two>*{max-width:calc(50% - 2px)}.section-gallery .row.three>*{max-width:calc(33.3333333% - 3px)}.section-block{margin-top:50px;margin-bottom:50px;min-height:100vh;max-width:100vw;position:relative;overflow:hidden}.section-block .block-background{clip:rect(0,auto,auto,0);position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1}.section-block .block-background>p{margin:0;padding:0}.section-block .block-background>p>img{width:100%}.section-block .block-background>:not(figcaption){position:fixed;top:0;left:0;width:100%;height:100vh;object-fit:cover}.section-block .block-panel{max-width:700px;width:100%;padding:10px 60px;background:rgba(0,0,0,.75);color:#fff;margin:90vh auto;border-radius:2px}.section-block .block-panel.block-panel-light{background:rgba(255,255,255,.75);color:#000}.section-block .block-panel p{font-size:22px;line-height:42px}.section-block .block-panel p br{margin-bottom:30px}.section-block figcaption{position:absolute;bottom:0;right:env(safe-area-inset-right);z-index:1;background:rgba(255,255,255,.7);font-size:9px}.section-right{float:right;max-width:350px;margin:10px -130px 30px 30px}@media screen and (max-width:440px){.section-right{float:none;max-width:100%;margin:0}}@media screen and (max-width:1200px){.section-right{margin-right:calc(-130px + env(safe-area-inset-right))}}.section-left{float:left;max-width:350px;margin:10px 30px 30px -130px}@media screen and (max-width:440px){.section-left{float:none;max-width:100%;margin:0}}@media screen and (max-width:1200px){.section-left{margin-left:calc(-130px + env(safe-area-inset-left))}}.main-gallery{position:fixed;top:0;left:0;width:100%;height:100%;transform:translateY(200%);transition:transform .3s ease}.main-gallery.visible{transform:translateY(0)}.main-gallery .overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85)}.main-gallery button{position:absolute;top:50%;transform:translateY(-50%);padding:0;width:64px;height:64px;background:rgba(47,154,231,.6);border:none;color:#fff;font-size:40px;line-height:62px;font-weight:700;cursor:pointer;font-family:Arial,Helvetica,sans-serif}@media screen and (max-width:440px){.main-gallery button{top:initial;bottom:env(safe-area-inset-bottom);transform:translate(0,0);background:rgba(47,154,231,.9)}}.main-gallery button.previous{left:env(safe-area-inset-left)}.main-gallery button.next{right:env(safe-area-inset-right)}.main-gallery button.close{top:env(safe-area-inset-top);transform:translate(0,0);right:env(safe-area-inset-right);background:rgba(170,12,12,.8);vertical-align:bottom}.main-gallery img{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);max-width:95%;max-height:95vh;box-shadow:0 0 40px rgba(0,0,0,.4);background:#fff}.main-gallery img.jiggle-left-1{animation-name:jiggle-left-1;animation-duration:.25s;animation-iteration-count:1}.main-gallery img.jiggle-left-2{animation-name:jiggle-left-2;animation-duration:.25s;animation-iteration-count:1}.main-gallery img.jiggle-right-1{animation-name:jiggle-right-1;animation-duration:.25s;animation-iteration-count:1}.main-gallery img.jiggle-right-2{animation-name:jiggle-right-2;animation-duration:.25s;animation-iteration-count:1}@keyframes jiggle-left-1{0%,100%{transform:translate(-50%,-50%)}50%{transform:translate(-49%,-50%)}}@keyframes jiggle-left-2{0%,100%{transform:translate(-50%,-50%)}50%{transform:translate(-49%,-50%)}}@keyframes jiggle-right-1{0%,100%{transform:translate(-50%,-50%)}50%{transform:translate(-51%,-50%)}}@keyframes jiggle-right-2{0%,100%{transform:translate(-50%,-50%)}50%{transform:translate(-51%,-50%)}}
</style></head> <body> <aside> <a href="/"> Nathan Hoad</a> <span></span> <a href="https://www.youtube.com/channel/UCZrNPqjLoBUY66z1hPm8Qug">Watch me on YouTube</a> <a href="https://twitter.com/nathanhoad">Follow me on Twitter</a> </aside> <article>
<header> <h1>2D water and lava shaders in Godot</h1> <aside class="meta">
March 2021 </aside> </header> <section>
<section data-type="wide">

<figure>
    <video src="water.mp4" autoplay playsinline muted loop></video>
    <figcaption>
        My water shader is pretty simple.
    </figcaption>
</figure>

</section>

<p><a href="https://youtu.be/nG8OU1GwMtk">Water shaders</a> are definitely something you can spend a lot of time on. Mine, however, is not one of those.</p>
<p>I like to keep things as simple as possible so that future me doesn&#39;t have to think too hard to remember how anything works.</p>
<section data-type="pull-left">

<p><img src="water-tiles.jpg" alt="Water tiles"><br><em>The water tiles are designed to sit on top of cliff tiles.</em></p>
</section>

<p>The water in my game is drawn initially as just another tile in the tileset.</p>
<p>Each of the different tiles is designed to pair up with a cliff tile so that the water sits on top and distorts the part of the cliff that sits below it.</p>
<p>The reddish/greenish squiggly colours are used to draw the foam and the solid blue is used to draw the water itself.</p>
<p>This makes a bit more sense once you see the shader code.</p>
<pre class="language-glsl"><code class="language-glsl">shader_type canvas_item<span class="token punctuation">;</span>

<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> color <span class="token operator">:</span> hint_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.58</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">float</span> translucency <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> foam_color <span class="token operator">:</span> hint_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">varying</span> <span class="token keyword">vec2</span> vert<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">vertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vert <span class="token operator">=</span> VERTEX<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">vec4</span> <span class="token keyword">input</span> <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>TEXTURE<span class="token punctuation">,</span> UV<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword control">if</span> <span class="token punctuation">(</span><span class="token keyword">input</span><span class="token punctuation">.</span>a <span class="token operator">==</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        COLOR <span class="token operator">=</span> <span class="token keyword">input</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Waves/rippling</span>
        <span class="token keyword">vec2</span> tiled_uvs <span class="token operator">=</span> UV <span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">;</span>
        <span class="token keyword">vec2</span> displacement <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span>
            <span class="token function">cos</span><span class="token punctuation">(</span>TIME <span class="token operator">*</span> <span class="token number">5.0</span> <span class="token operator">+</span> tiled_uvs<span class="token punctuation">.</span>x <span class="token operator">+</span> tiled_uvs<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.002</span><span class="token punctuation">,</span>
            <span class="token function">cos</span><span class="token punctuation">(</span>TIME <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">+</span> tiled_uvs<span class="token punctuation">.</span>x <span class="token operator">+</span> tiled_uvs<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.002</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Below the surface</span>
        <span class="token keyword">vec4</span> refraction <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>SCREEN_TEXTURE<span class="token punctuation">,</span> SCREEN_UV <span class="token operator">+</span> displacement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Weird stuff happens at the 0,0 seam</span>
        <span class="token keyword control">if</span> <span class="token punctuation">(</span>vert<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">1.0</span> <span class="token operator">||</span> vert<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            refraction <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>SCREEN_TEXTURE<span class="token punctuation">,</span> SCREEN_UV<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// The actual water color is a mix of the surface and below</span>
        <span class="token keyword">vec4</span> water <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>refraction<span class="token punctuation">,</span> color<span class="token punctuation">,</span> translucency<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// To simulate waves we alternate between the red pixels</span>
        <span class="token comment">// and the green pixels as the white foam</span>
        <span class="token keyword">bool</span> use_red <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>TIME<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">// NOTE: green is "on top", meaning it is closer to the rocks/shore than</span>
        <span class="token comment">// red so we need a special case to make sure green is transparent</span>
        <span class="token keyword control">if</span> <span class="token punctuation">(</span>use_red<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword control">if</span> <span class="token punctuation">(</span><span class="token keyword">input</span><span class="token punctuation">.</span>r <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                COLOR <span class="token operator">=</span> foam_color<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token keyword control">if</span> <span class="token punctuation">(</span><span class="token keyword">input</span><span class="token punctuation">.</span>b <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                COLOR <span class="token operator">=</span> water<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token punctuation">{</span>
                COLOR <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token punctuation">{</span>
            <span class="token keyword control">if</span> <span class="token punctuation">(</span><span class="token keyword">input</span><span class="token punctuation">.</span>g <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                COLOR <span class="token operator">=</span> foam_color<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token punctuation">{</span>
                COLOR <span class="token operator">=</span> water<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So this shader is broken up into three steps.</p>
<p>Step 1 is to work out the refraction of what&#39;s below the surface.</p>
<p>To get the displacement or the waviness we just use cos, time, and the input UV to get it animating.</p>
<p>Step 2 is to mix that with the actual water colour which is given in a uniform.</p>
<p>And step 3 is to work out this foam which is based on the murky red and green that we saw earlier.</p>
<p>We alternate between red and green each second. If we are currently looking for red, and the pixel below is red then it&#39;s foam.</p>
<p>If it&#39;s blue, then it&#39;s water. Anything else is just transparent.</p>
<p>And then if we&#39;re looking for green and the pixel is green: foam, otherwise: water.</p>
<p>And that&#39;s it for the water shader.</p>
<section data-type="wide">

<figure>
    <video src="lava.mp4" autoplay playsinline muted loop></video>
    <figcaption>
        A lava shader isn't that different to a water shader.
    </figcaption>
</figure>

</section>

<p>Now let&#39;s see how we can modify it a little to <a href="https://youtu.be/VxzElAcKZzY">get a <em>lava</em> shader</a>.</p>
<p>We use the same tileset tiles but swap out for a different shader.</p>
<p>The main difference between the two is how we calculate the surface.</p>
<section data-type="pull-right">

<p><img src="noise.jpg" alt="Noise texture"><br><em>Godot has a built-in Open Simplex Noise texture generator.</em></p>
</section>

<p>I&#39;ve added a <code>sampler2D</code> uniform called <code>surface_texture</code> that will I&#39;ve populated with an <code>OpenSimplexNoise</code> texture in Godot.</p>
<p>This gives us some seemingly random (but still gradually changing per pixel) input to use when generating the coloured areas for the lava.</p>
<p>If we move the texture over a copy of itself we get blobs of white that grow and shrink over time.</p>
<p>We can colour them based on their brightness.</p>
<p>The whole shader isn&#39;t overly complicated:</p>
<pre class="language-glsl"><code class="language-glsl">shader_type canvas_item<span class="token punctuation">;</span>
render_mode unshaded<span class="token punctuation">;</span>

<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> color <span class="token operator">:</span> hint_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> lighter_color<span class="token operator">:</span> hint_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.47</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> darker_color <span class="token operator">:</span> hint_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> edge_color <span class="token operator">:</span> hint_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">sampler2D</span> surface_texture<span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec2</span> flow_speed <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">varying</span> <span class="token keyword">vec2</span> vert<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">vertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vert <span class="token operator">=</span> VERTEX<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">vec4</span> <span class="token keyword">input</span> <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>TEXTURE<span class="token punctuation">,</span> UV<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword control">if</span> <span class="token punctuation">(</span><span class="token keyword">input</span><span class="token punctuation">.</span>a <span class="token operator">==</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        COLOR <span class="token operator">=</span> <span class="token keyword">input</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// For the surface we move the noise texture over itself to generate blobs</span>
        <span class="token keyword">vec2</span> map_uv <span class="token operator">=</span> vert <span class="token operator">/</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">512.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> surface1 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>surface_texture<span class="token punctuation">,</span> map_uv <span class="token operator">+</span> <span class="token function">floor</span><span class="token punctuation">(</span>TIME <span class="token operator">*</span> flow_speed<span class="token punctuation">)</span> <span class="token operator">*</span> TEXTURE_PIXEL_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> surface2 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>surface_texture<span class="token punctuation">,</span> map_uv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> v <span class="token operator">=</span> <span class="token punctuation">(</span>surface1 <span class="token operator">+</span> surface2<span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">;</span>

        <span class="token comment">// Then we colour each blob area based on its brightness</span>
        <span class="token keyword">vec4</span> lava <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token keyword control">if</span> <span class="token punctuation">(</span>v <span class="token operator">>=</span> <span class="token number">1.1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lava <span class="token operator">=</span> darker_color<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token keyword control">if</span> <span class="token punctuation">(</span>v <span class="token operator">></span> <span class="token number">0.95</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lava <span class="token operator">=</span> lighter_color<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Then we actually render the lava based on the actual pixel</span>
        <span class="token keyword control">if</span> <span class="token punctuation">(</span><span class="token keyword">input</span><span class="token punctuation">.</span>r <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            COLOR <span class="token operator">=</span> edge_color<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token keyword control">if</span> <span class="token punctuation">(</span><span class="token keyword">input</span><span class="token punctuation">.</span>b <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            COLOR <span class="token operator">=</span> lava<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control">else</span> <span class="token punctuation">{</span>
            COLOR <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And that&#39;s it for lava.</p>
<hr>
<p>If you&#39;re the kind of person that prefers to see these things in video format then you&#39;re in luck! I have videos about both of these shaders on my game dev YouTube channel:</p>
<section data-type="gallery" data-layout="2">

<p><a href="https://youtu.be/nG8OU1GwMtk"><img src="water-thumb.png" alt="YouTube: Super simple 2D water shader in Godot"></a><br><em>YouTube: Super simple 2D water shader in Godot.</em></p>
<p><a href="https://youtu.be/VxzElAcKZzY"><img src="lava-thumb.png" alt="YouTube: Simple 2D Lava in Godot"></a><br><em>YouTube: Simple 2D Lava in Godot.</em></p>
</section>

<p>Feel free to <a href="https://www.youtube.com/channel/UCZrNPqjLoBUY66z1hPm8Qug">subscribe on YouTube</a> for more game dev videos.</p>
</section> </article> <footer>
<div>
<p>
If you want to keep up to date with my adventures in game development then you can
<a href="https://twitter.com/nathanhoad">follow me on Twitter</a> or
<a href="https://www.youtube.com/channel/UCZrNPqjLoBUY66z1hPm8Qug">subscribe to my YouTube channel</a>.
</p>
</div>
<ul>
<li><a href="https://twitter.com/nathanhoad">Twitter</a></li>
<li>
<a href="https://www.youtube.com/channel/UCZrNPqjLoBUY66z1hPm8Qug">YouTube</a>
</li>
<li><a href="https://nathanhoad.itch.io">Itch</a></li>
<li><a href="https://github.com/nathanhoad">GitHub</a></li>
</ul>
<aside>&copy <span>2021</span> Nathan Hoad</aside>
</footer> </body> </html>